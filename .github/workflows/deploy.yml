name: Deploy to Vercel

on:
  push:
    branches: [ main, development ]
  pull_request:
    branches: [ main ]

env:
  VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
  VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
  VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Run tests
      run: npm test || echo "–¢–µ—Å—Ç—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"
      
    - name: Verify Vercel configuration
      run: |
        echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Vercel..."
        echo "Organization ID: $VERCEL_ORG_ID"
        echo "Project ID: $VERCEL_PROJECT_ID"
        echo "Token: ${VERCEL_TOKEN:0:10}..."
        
        if [ -z "$VERCEL_TOKEN" ]; then
          echo "‚ùå VERCEL_TOKEN –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
          exit 1
        fi
        
        if [ -z "$VERCEL_ORG_ID" ]; then
          echo "‚ùå VERCEL_ORG_ID –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
          exit 1
        fi
        
        if [ -z "$VERCEL_PROJECT_ID" ]; then
          echo "‚ùå VERCEL_PROJECT_ID –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
          exit 1
        fi
        
        echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vercel –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞"
      
    - name: Deploy to Vercel
      id: deploy
      uses: amondnet/vercel-action@v25
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
        vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
        vercel-args: '--prod'
        github-comment: true
        github-deployment: false
        working-directory: ./
      continue-on-error: true
      
    - name: Check deployment status
      if: steps.deploy.outcome == 'failure'
      run: |
        echo "‚ùå –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Vercel –Ω–µ —É–¥–∞–ª–æ—Å—å"
        echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub Secrets:"
        echo "- VERCEL_TOKEN"
        echo "- VERCEL_ORG_ID" 
        echo "- VERCEL_PROJECT_ID"
        echo ""
        echo "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ: VERCEL_TOKEN_SETUP.md"
        
    - name: Success notification
      if: steps.deploy.outcome == 'success'
      run: |
        echo "‚úÖ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Vercel —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
        echo "üåê –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ —Å—Å—ã–ª–∫–µ –≤—ã—à–µ" 