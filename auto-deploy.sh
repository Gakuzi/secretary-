#!/bin/bash

echo "ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –°–µ–∫—Ä–µ—Ç–∞—Ä—å+ –Ω–∞ Vercel"
echo "=================================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å git
if [ -n "$(git status --porcelain)" ]; then
    echo "üìù –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
    echo "üíæ –ö–æ–º–º–∏—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
    git add .
    git commit -m "üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ - $(date '+%Y-%m-%d %H:%M:%S')"
    echo "‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã"
else
    echo "‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É–∂–µ –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã"
fi

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ GitHub
echo "üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ GitHub..."
git push origin main
echo "‚úÖ –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ GitHub"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ vercel.json
if [ -f "vercel.json" ]; then
    echo "üìã –ù–∞–π–¥–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è vercel.json"
    CONFIG_FILE="vercel.json"
elif [ -f "vercel.simple.json" ]; then
    echo "üìã –ù–∞–π–¥–µ–Ω–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è vercel.simple.json"
    echo "üîÑ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º –≤ vercel.json..."
    mv vercel.simple.json vercel.json
    CONFIG_FILE="vercel.json"
else
    echo "‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vercel –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
    echo "üîß –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é..."
    cat > vercel.json << 'EOF'
{
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
EOF
    CONFIG_FILE="vercel.json"
    echo "‚úÖ –°–æ–∑–¥–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è vercel.json"
fi

# –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ Vercel
echo "üöÄ –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ Vercel..."
echo "üìÅ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: $CONFIG_FILE"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ Vercel
if vercel ls 2>/dev/null | grep -q "secretary-"; then
    echo "üîÑ –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–µ–∫—Ç..."
    vercel --prod --yes
else
    echo "üÜï –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç..."
    vercel --prod --yes
fi

echo ""
echo "üéâ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo "üåê –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É –≤—ã—à–µ"
echo ""
echo "üí° –¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç–µ –º–Ω–µ —Å–≤–æ–∏ –∏–¥–µ–∏, –∏ —è –±—É–¥—É:"
echo "   1. –†–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –∏—Ö –≤ –∫–æ–¥–µ"
echo "   2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –Ω–∞ Vercel"
echo "   3. –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏!"
echo ""
echo "üîó GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: https://github.com/Gakuzi/secretary-" 